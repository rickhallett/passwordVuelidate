<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="libs/vuelidate.min.js"></script>
    <script src="libs/validators.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">
    <h1>Reset Password</h1>
    <form @submit.prevent="submitForm" autocomplete="off">

        <div class="form-group">
            <label for="name">Name:</label>
            <input v-model="form.name"
                   @blur="$v.form.name.$touch()"
                   :class="{error: shouldAppendErrorClass($v.form.name), valid: shouldAppendValidClass($v.form.name)}"
                   id="name"
            >
            <p v-if="$v.form.name.$error" class="error-message">The name field is required</p>
        </div>

        <div class="form-group">
            <label for="age">Age:</label>
            <input v-model.number="form.age"
                   @blur="$v.form.age.$touch()"
                   :class="{error: shouldAppendErrorClass($v.form.age), valid: shouldAppendValidClass($v.form.age)}"
                   id="age"
            >
            <div v-if="$v.form.age.$error">
                <p v-if="!$v.form.age.required" class="error-message">The age field is required</p>
                <p v-else-if="!$v.form.age.integer" class="error-message">The age field should be an integer</p>
                <p v-else-if="!$v.form.age.oldEnoughAndAlive" class="error-message">You should be at least 12 and younger than 120 to continue</p>
            </div>
        </div>

        <div class="form-group">
            <label for="newsletter">Subscribe to the newsletter:</label>
            <input v-model="form.newsletter"
                   type="checkbox"
                   id="newsletter"
            >
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input v-model="form.email"
                   @blur="$v.form.email.$touch()"
                   :class="{error: shouldAppendErrorClass($v.form.email), valid: shouldAppendValidClass($v.form.email)}"
                   id="email"
            >
            <p v-if="!$v.form.email.email && $v.form.email.$error" class="error-message">Invalid email address</p>
            <p v-if="!$v.form.email.required && $v.form.email.$error" class="error-message">Email is required so we can reset your password</p>
        </div>

        <div class="form-group github-username">
            <label for="github-username">GitHub username:</label>
            <input v-model.lazy="$v.form.githubUsername.$model"
                   :class="{error: shouldAppendErrorClass($v.form.githubUsername), valid: shouldAppendValidClass($v.form.githubUsername)}"
                   id="github-username"
            >
            <span v-show="$v.form.githubUsername.$pending" class="fa fa-spinner fa-spin"></span>
            <p v-if="!$v.form.githubUsername.exists && $v.form.githubUsername.$error" class="error-message">There is not GitHub user with this username</p>
        </div>

        <div>
            <button>Submit</button>
        </div>

    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<script>
    Vue.use(vuelidate.default);

    const oldEnoughAndAlive = validators.between(12, 120);

    new Vue({
        el: '#app',

        data () {
            return {
                form: {
                    name: null,
                    age: null,
                    email: null,
                    newsletter: null,
                    githubUsername: null
                }
            }
        },

        validations: {
            form: {
                name: {
                    required: validators.required
                },

                age: {
                    required: validators.required, // $v.form.age.required
                    integer: validators.integer, // $v.form.age.integer
                    oldEnoughAndAlive // $v.form.age.oldEnoughAndAlive
                },

                password: {

                },

                email: {
                    email: validators.email,
                    required: validators.requiredIf(function () {
                        return true;
                    })
                },

                githubUsername: {
                    exists (value) {
                        if (!validators.helpers.req(value)) {
                            return true
                        }
                        return axios.get(`//api.github.com/users/${value}`)
                    }
                }
            }
        },

        methods: {
            shouldAppendValidClass (field) { // ex: field = $v.form.email
                return !field.$invalid && field.$model && field.$dirty;
            },

            shouldAppendErrorClass (field) { // ex: field = $v.form.email
                return field.$error;
            },

            submitForm () {
                this.$v.form.$touch();
                if (!this.$v.form.$invalid) {
                    console.log('üìù Form Submitted', this.form);
                } else {
                    console.log('‚ùå Invalid form');
                }
            }
        }
    });

    /**
     * {
        login: "rickhallett",
        id: 29977869,
        node_id: "MDQ6VXNlcjI5OTc3ODY5",
        avatar_url: "https://avatars3.githubusercontent.com/u/29977869?v=4",
        gravatar_id: "",
        url: "https://api.github.com/users/rickhallett",
        html_url: "https://github.com/rickhallett",
        followers_url: "https://api.github.com/users/rickhallett/followers",
        following_url: "https://api.github.com/users/rickhallett/following{/other_user}",
        gists_url: "https://api.github.com/users/rickhallett/gists{/gist_id}",
        starred_url: "https://api.github.com/users/rickhallett/starred{/owner}{/repo}",
        subscriptions_url: "https://api.github.com/users/rickhallett/subscriptions",
        organizations_url: "https://api.github.com/users/rickhallett/orgs",
        repos_url: "https://api.github.com/users/rickhallett/repos",
        events_url: "https://api.github.com/users/rickhallett/events{/privacy}",
        received_events_url: "https://api.github.com/users/rickhallett/received_events",
        type: "User",
        site_admin: false,
        name: "Rick Hallett",
        company: "Studied with @gordonmzhu",
        blog: "",
        location: "School Business Services",
        email: null,
        hireable: null,
        bio: "Junior software developer",
        public_repos: 106,
        public_gists: 9,
        followers: 29,
        following: 93,
        created_at: "2017-07-07T11:29:36Z",
        updated_at: "2019-09-23T23:37:21Z"
        }
     */
</script>
</body>
</html>


